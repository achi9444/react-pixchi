import{r as c,j as n}from"./index-B0vGKiOm.js";const o=25;function R(){const[a,S]=c.useState(16),[h,u]=c.useState(Array(16).fill(null).map(()=>Array(16).fill("#ffffff"))),[f,E]=c.useState("#ff6b6b"),[p,i]=c.useState(!1),[C,m]=c.useState(!1),[x,w]=c.useState(!0),j=c.useRef(null),v=e=>Array(e).fill(null).map(()=>Array(e).fill("#ffffff")),d=(e,t)=>{e<0||t<0||e>=a||t>=a||u(s=>{const r=s.map(l=>[...l]);return r[e][t]=C?"#ffffff":f,r})},N=(e,t)=>{i(!0),d(e,t)},b=(e,t)=>{p&&d(e,t)},k=()=>i(!1),G=(e,t,s)=>{e.preventDefault(),i(!0),d(t,s)},y=e=>{e.preventDefault();const t=e.touches[0],s=document.elementFromPoint(t.clientX,t.clientY);if(s&&s.dataset.row&&s.dataset.col){const r=parseInt(s.dataset.row,10),l=parseInt(s.dataset.col,10);p&&d(r,l)}},M=()=>i(!1),D=()=>u(v(a)),L=()=>{const e=document.createElement("canvas");e.width=a*o,e.height=a*o;const t=e.getContext("2d");h.forEach((r,l)=>r.forEach((I,g)=>{t.fillStyle=I,t.fillRect(g*o,l*o,o,o),x&&(t.strokeStyle="#ccc",t.strokeRect(g*o,l*o,o,o))}));const s=document.createElement("a");s.download=`perler-${a}x${a}.png`,s.href=e.toDataURL(),s.click()},T=e=>{const t=parseInt(e.target.value,10);!isNaN(t)&&t>0&&t<=64&&(S(t),u(v(t)))};return c.useEffect(()=>{const e=j.current;if(!e)return;const t=s=>s.preventDefault();return e.addEventListener("touchmove",t,{passive:!1}),()=>e.removeEventListener("touchmove",t)},[]),n.jsxs("div",{className:"perler-container",ref:j,onMouseUp:k,onTouchEnd:M,onTouchMove:y,children:[n.jsxs("div",{className:"perler-tools",children:[n.jsx("input",{type:"color",value:f,onChange:e=>E(e.target.value)}),n.jsx("button",{onClick:()=>m(!1),children:"畫筆"}),n.jsx("button",{onClick:()=>m(!0),children:"橡皮擦"}),n.jsx("button",{onClick:D,children:"清空"}),n.jsx("button",{onClick:L,children:"匯出 PNG"}),n.jsxs("label",{children:["格數：",n.jsx("input",{type:"number",min:"4",max:"64",value:a,onChange:T})]}),n.jsxs("label",{children:[n.jsx("input",{type:"checkbox",checked:x,onChange:e=>w(e.target.checked)}),"匯出時顯示格線"]})]}),n.jsx("div",{className:"perler-grid",children:h.map((e,t)=>n.jsx("div",{className:"perler-row",children:e.map((s,r)=>n.jsx("div",{className:"perler-cell",style:{backgroundColor:s,width:o,height:o},"data-row":t,"data-col":r,onMouseDown:()=>N(t,r),onMouseEnter:()=>b(t,r),onTouchStart:l=>G(l,t,r)},r))},t))})]})}const A=()=>n.jsx(n.Fragment,{children:n.jsxs("main",{className:"classMain",children:[n.jsxs("header",{className:"perler-header",children:[n.jsx("h2",{children:"拼豆模擬器"}),n.jsxs("p",{children:["歡迎使用拼豆模擬器！你可以自訂格數、選擇顏色、使用畫筆或橡皮擦進行創作。",n.jsx("br",{}),"完成後還能匯出 PNG 圖片，並選擇是否顯示格線。"]})]}),n.jsx("section",{className:"perler-main",children:n.jsx(R,{})})]})});export{A as default};
